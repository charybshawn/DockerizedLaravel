server {
    listen 80;
    server_name localhost;
    
    # Nginx status endpoint
    location {{ nginx_status_path }} {
        stub_status on;
        access_log off;
        
        # Restrict access to specific IPs
{% for ip in nginx_status_allowed_ips %}
        allow {{ ip }};
{% endfor %}
        deny all;
    }
    
    # Basic health check endpoint
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
    
    # Server info endpoint (for debugging)
    location /server-info {
        access_log off;
        
        # Restrict access to specific IPs
{% for ip in nginx_status_allowed_ips %}
        allow {{ ip }};
{% endfor %}
        deny all;
        
        return 200 '{
            "hostname": "$hostname",
            "nginx_version": "$nginx_version",
            "server_addr": "$server_addr",
            "server_port": "$server_port",
            "time_iso8601": "$time_iso8601",
            "request_time": "$request_time"
        }';
        add_header Content-Type application/json;
    }
}